% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Basket Market Analysis},
  pdfauthor={W.Lu},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering

\title{Basket Market Analysis}
\author{W.Lu}
\date{12/02/2020}

\begin{document}
\maketitle

\hypertarget{introduction}{%
\subsection{Introduction}\label{introduction}}

The basket marketing analysis we are using for figure out the
relationship between orders and skus.

Find the related Sku according to the Association Rules.

After cleaning the data and mining the data from mysql.

I have choosed the completed order from imarket data , and to
investigate the relationship inside.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load library}
\KeywordTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'dplyr'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:stats':
## 
##     filter, lag
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(arules)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: Matrix
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'arules'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:dplyr':
## 
##     recode
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     abbreviate, write
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(arulesViz)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: grid
\end{verbatim}

\begin{verbatim}
## Registered S3 method overwritten by 'seriation':
##   method         from 
##   reorder.hclust gclus
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(stringr)}
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{library}\NormalTok{(RColorBrewer)}
\CommentTok{# Read file}

\NormalTok{data <-}\StringTok{ }\KeywordTok{read.csv}\NormalTok{(}\StringTok{'combined.csv'}\NormalTok{,}\DataTypeTok{sep=}\StringTok{','}\NormalTok{,}\DataTypeTok{na.strings =} \StringTok{" "}\NormalTok{)}
\KeywordTok{str}\NormalTok{(data)}
\CommentTok{# Check that all orders in line_item are present in our orders dataset. }
\CommentTok{# Exclude from line_item any rows that do not meet that condition.}
\KeywordTok{summary}\NormalTok{(data)}
\CommentTok{# We don't need product_id because its all 0 }
\NormalTok{data}\OperatorTok{$}\NormalTok{state <-}\StringTok{ }\OtherTok{NULL} 
\KeywordTok{summary}\NormalTok{(data)}

\KeywordTok{colnames}\NormalTok{(data) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'order'}\NormalTok{,}\StringTok{'sku'}\NormalTok{)}

\CommentTok{#data$sku = as.character(data$sku)}

\CommentTok{#data = as(data, "transactions")}

\CommentTok{# write cv }
\KeywordTok{write.csv}\NormalTok{(data,}\DataTypeTok{file=}\StringTok{"data.csv"}\NormalTok{,}\DataTypeTok{row.names =} \OtherTok{FALSE}\NormalTok{)}


\CommentTok{#creating transition matrix}

\NormalTok{tran <-}\StringTok{ }\KeywordTok{read.transactions}\NormalTok{(}\StringTok{'data.csv'}\NormalTok{, }\DataTypeTok{format =} \KeywordTok{c}\NormalTok{(}\StringTok{'single'}\NormalTok{), }\DataTypeTok{sep=}\StringTok{','}\NormalTok{, }\DataTypeTok{cols =} \KeywordTok{c}\NormalTok{(}\StringTok{"order"}\NormalTok{, }\StringTok{"sku"}\NormalTok{), }\DataTypeTok{header =} \OtherTok{TRUE}\NormalTok{)}

\KeywordTok{inspect}\NormalTok{(tran)}
\CommentTok{# number of transactions}
\KeywordTok{length}\NormalTok{(tran)}
\CommentTok{# Number of items per transaction }
\KeywordTok{size}\NormalTok{(tran)}
\CommentTok{# Lists the transactions by conversion (LIST must be capitalized)}
\KeywordTok{LIST}\NormalTok{(tran)}
\CommentTok{# To see the item labels }
\KeywordTok{itemLabels}\NormalTok{(tran)}

\KeywordTok{itemFrequencyPlot}\NormalTok{(tran,}\DataTypeTok{topN=}\DecValTok{20}\NormalTok{,}\DataTypeTok{type=}\StringTok{"absolute"}\NormalTok{,}\DataTypeTok{col=}\KeywordTok{brewer.pal}\NormalTok{(}\DecValTok{8}\NormalTok{,}\StringTok{'Pastel2'}\NormalTok{), }\DataTypeTok{main=}\StringTok{"Absolute Item Frequency Plot"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{marketbasket-report_files/figure-latex/cars-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Calculate rules use Apriori algorithm and specifying support and confidency }
\NormalTok{rules=}\KeywordTok{apriori}\NormalTok{(tran,}\DataTypeTok{parameter=}\KeywordTok{list}\NormalTok{(}\DataTypeTok{support=}\FloatTok{0.00005}\NormalTok{,}\DataTypeTok{confidence=}\FloatTok{0.00006}\NormalTok{,}\DataTypeTok{maxlen=}\DecValTok{3}\NormalTok{))}

\KeywordTok{length}\NormalTok{(rules) }\CommentTok{# 5005 rules}
\NormalTok{subset.Rules<-rules[}\KeywordTok{quality}\NormalTok{(rules)}\OperatorTok{$}\NormalTok{confidence}\OperatorTok{>}\FloatTok{0.4}\NormalTok{]}
\KeywordTok{length}\NormalTok{(subset.Rules)  }\CommentTok{# 122}

\CommentTok{# Inspect the top 10 rules in term of confidence }
\KeywordTok{inspect}\NormalTok{(rules)}
\KeywordTok{inspect}\NormalTok{(}\KeywordTok{head}\NormalTok{(}\KeywordTok{sort}\NormalTok{(rules,}\DataTypeTok{by=}\StringTok{'lift'}\NormalTok{),}\DecValTok{10}\NormalTok{))}
\KeywordTok{inspect}\NormalTok{(subset.Rules)}
\KeywordTok{inspect}\NormalTok{(}\KeywordTok{head}\NormalTok{(}\KeywordTok{sort}\NormalTok{(subset.Rules,}\DataTypeTok{by=}\StringTok{'lift'}\NormalTok{),}\DecValTok{10}\NormalTok{))}
\NormalTok{top10subRules <-}\StringTok{ }\KeywordTok{head}\NormalTok{(subset.Rules, }\DataTypeTok{n =} \DecValTok{10}\NormalTok{, }\DataTypeTok{by =} \StringTok{"confidence"}\NormalTok{)}
\CommentTok{# Visulize the rules }
\KeywordTok{plot}\NormalTok{(subset.Rules,}\DataTypeTok{method=}\StringTok{"grouped matrix"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{marketbasket-report_files/figure-latex/cars-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(top10subRules, }\DataTypeTok{method =} \StringTok{"graph"}\NormalTok{,  }\DataTypeTok{engine =} \StringTok{"htmlwidget"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(subset.Rules,}\DataTypeTok{method=}\StringTok{"matrix"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{marketbasket-report_files/figure-latex/cars-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(}\KeywordTok{head}\NormalTok{(}\KeywordTok{sort}\NormalTok{(subset.Rules,}\DataTypeTok{by=}\StringTok{'lift'}\NormalTok{),}\DecValTok{20}\NormalTok{),}\DataTypeTok{method=}\StringTok{"graph"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{marketbasket-report_files/figure-latex/cars-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{saveAsGraph}\NormalTok{(}\KeywordTok{head}\NormalTok{(subset.Rules, }\DataTypeTok{n =} \DecValTok{100}\NormalTok{, }\DataTypeTok{by =} \StringTok{"lift"}\NormalTok{), }\DataTypeTok{file =} \StringTok{"rules.graphml"}\NormalTok{)}
\CommentTok{# Filter top 20 rules with highest lift}
\NormalTok{subRules2<-}\KeywordTok{head}\NormalTok{(subset.Rules, }\DataTypeTok{n=}\DecValTok{20}\NormalTok{, }\DataTypeTok{by=}\StringTok{"lift"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(subRules2, }\DataTypeTok{method=}\StringTok{"paracoord"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{marketbasket-report_files/figure-latex/cars-5.pdf}

\end{document}
